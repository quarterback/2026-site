---
interface Track {
  name: string;
  artist: string;
  url: string;
  image?: string;
  playcount?: string;
}

interface Props {
  tracks?: Track[];
  embedUrl?: string;
  embedType?: 'spotify' | 'apple' | 'mixcloud';
  title?: string;
}

const { tracks = [], embedUrl, embedType = 'spotify', title = 'Recently Played' } = Astro.props;
---

<section class="music">
  <h2 class="music__title">{title}</h2>

  {embedUrl && (
    <div class="music__embed">
      {embedType === 'spotify' && (
        <iframe
          src={embedUrl}
          width="100%"
          height="380"
          frameborder="0"
          allowtransparency="true"
          allow="encrypted-media"
        ></iframe>
      )}
      {embedType === 'apple' && (
        <iframe
          src={embedUrl}
          width="100%"
          height="450"
          frameborder="0"
          allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write"
          sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation"
        ></iframe>
      )}
      {embedType === 'mixcloud' && (
        <iframe
          src={embedUrl}
          width="100%"
          height="120"
          frameborder="0"
        ></iframe>
      )}
    </div>
  )}

  {tracks.length > 0 && (
    <ul class="music__tracks">
      {tracks.map((track) => (
        <li class="track">
          {track.image && (
            <img src={track.image} alt={`${track.name} album art`} class="track__image" />
          )}
          <div class="track__info">
            <a href={track.url} target="_blank" rel="noopener" class="track__name">
              {track.name}
            </a>
            <span class="track__artist">{track.artist}</span>
          </div>
          {track.playcount && (
            <span class="track__plays">{track.playcount} plays</span>
          )}
        </li>
      ))}
    </ul>
  )}
</section>

<style>
  .music {
    margin-block: var(--size-10);
  }

  .music__title {
    font-size: var(--font-size-4);
    font-weight: var(--font-weight-6);
    margin-block-end: var(--size-6);
  }

  .music__embed {
    margin-block-end: var(--size-6);
    border-radius: var(--radius-2);
    overflow: hidden;
    background: var(--surface-2);
  }

  .music__tracks {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    gap: var(--size-3);
  }

  .track {
    display: flex;
    align-items: center;
    gap: var(--size-3);
    padding: var(--size-3);
    background: var(--surface-2);
    border-radius: var(--radius-2);
    transition: background-color 0.2s ease;
  }

  .track:hover {
    background: var(--surface-3);
  }

  .track__image {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-1);
    object-fit: cover;
    flex-shrink: 0;
  }

  .track__info {
    flex: 1;
    min-width: 0;
  }

  .track__name {
    display: block;
    font-weight: var(--font-weight-5);
    color: var(--text-1);
    text-decoration: none;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .track__name:hover {
    color: var(--brand);
    text-decoration: underline;
  }

  .track__artist {
    display: block;
    font-size: var(--font-size-0);
    color: var(--text-2);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .track__plays {
    font-size: var(--font-size-0);
    color: var(--text-3);
    flex-shrink: 0;
  }
</style>
