---
import { getCollection } from 'astro:content';
import Base from '../layouts/Base.astro';
import Hero from '../components/Hero.astro';
import WorkCard from '../components/WorkCard.astro';
import Writing from '../components/Writing.astro';
import Books from '../components/Books.astro';
import Albums from '../components/Albums.astro';
import MediaCard from '../components/MediaCard.astro';
import Contact from '../components/Contact.astro';
import Footer from '../components/Footer.astro';
import { fetchMultipleRSS } from '../lib/rss';

const allWork = await getCollection('work', ({ data }) => !data.draft);
const featuredWork = allWork.filter(({ data }) => data.featured);
const work = featuredWork.sort((a, b) => a.data.order - b.data.order);

const rssFeeds = [
  'https://makingpublicwork.com/rss/',
  'https://blog.ronbronson.com/feed.rss',
];

let recentPosts: any[] = [];
try {
  const allPosts = await fetchMultipleRSS(rssFeeds);
  recentPosts = allPosts.slice(0, 5);
} catch (error) {
  console.error('Failed to fetch RSS feeds:', error);
  recentPosts = [];
}

const currentBooks = [
  {
    title: "Waging A Good War",
    author: "Thomas E. Ricks",
  },
  {
    title: "Maintenance of Everything: Part One",
    author: "Stewart Brand",
  },
  {
    title: "Religion And The Decline of Magic",
    author: "Keith Thomas",
  },
  {
    title: "The Field Guide to Design Futures",
    author: "Giovanni Caruso, Silvio Cioni",
  },
];

const currentAlbums = [
  {
    title: "The Jungle",
    artist: "Wynton Marsalis",
  },
  {
    title: "Italo disco",
  },
  {
    title: "KCRW, NTS & The Lot Radio,
  },
];

const recentMedia = [
  {
    title: "Some advice on managing your design career upwards",
    source: "Piccalil.li",
    mediaType: "article" as const,
    url: "https://piccalil.li/blog/some-advice-on-managing-your-design-career-upwards/",
    date: "January 2026",
  },
  {
    title: "Interview w/Ron Bronson",
    source: "Did I Do That Podcast",
    mediaType: "podcast" as const,
    embedUrl: "https://schumacher.substack.com/p/ron-bronson-what-huh-me-huh-what",
    date: "October 2025",
  },
  {
    title: "On Servive Design",
    source: "Surfacing Podcast",
    mediaType: "podcast" as const,
    embedUrl: "https://open.spotify.com/episode/2lC2xrhf4PIasyzJW4faP7",
    date: "2021",
  },
  {
    title: "Beyond Civic Tech: Public Mechanics Starts at Home",
    source: "Cascadia Open Source Fall Conference",
    mediaType: "talk" as const,
    embedUrl: "https://youtube.com/watch?v=hnAScuK-oMo",
    date: "2025",
  },
];

const socials = [
  { name: "Bluesky", url: "https://bsky.app/profile/ronbronson.com" },
  { name: "LinkedIn", url: "https://linkedin.com/in/ronbronson" },
  { name: "GitHub", url: "https://github.com/ronbronson" },
];

const techStack = [
  "built hastily using Astro, Open Props, FontAwesome, TypeScript, Inter, JetBrains Mono, Netlify & GitHub"
];

const fonts: string[] = [];
---

<Base title="Ron Bronson">
  <main>
    <Hero
      headline="I work on how systems make decisions"
      subheadline="I help institutions design, govern, and oversee AI‑driven decisions.

I work with leaders who need clarity on how their systems should delegate authority, manage risk, and maintain trust as they adopt AI. My background spans service design, civic tech, and federal digital transformation — all focused on how organizations make decisions at scale.

Today, I work on decision infrastructure at <a href="https://occupant.ee">Occupant</a>, teach at the <a href="https://taubmancollege.umich.edu/faculty/directory/ron-bronson/">University of Michigan</a> and built <a href="https://statecapacity.ai>State Capacity AI</a>. Previously, I was Head of Design at 18F.gov"
      primaryCTA={{ label: "About me", url: "/about", icon: "fa-user" }}
      secondaryCTA={{ label: "Let's connect", url: "https://linkedin.com/in/ronbronson", icon: "fa-linkedin" }}
    />

    <!-- Currently - AIM style status -->
    <section class="currently-section">
      <div class="container">
        <div class="currently-content">
          <p class="label">Currently</p>
          <p class="currently-status">Wishing they'd bring Andor back to television.</p>
        </div>
      </div>
    </section>

    <!-- Selected Work - Hidden for launch -->
    <!--
    <section id="work">
      <div class="container">
        <h2 class="section-heading">Selected Work</h2>
        <div class="work-grid">
          {work.map(item => (
            <WorkCard
              title={item.data.title}
              type={item.data.type}
              lede={item.data.lede}
              metadata={item.data.metadata}
              href={`/work/${item.slug}`}
              featured={item.data.featured}
            />
          ))}
        </div>
      </div>
    </section>
    -->

    <!-- Featured Media -->
    <section id="media">
      <div class="container">
        <h2 class="section-heading">Featured Media</h2>
        <div class="media-list-featured">
          {recentMedia.map(item => (
            <MediaCard {...item} />
          ))}
        </div>
      </div>
    </section>

    <!-- Media Section: Books & Albums side by side -->
    <section id="media-consumption">
      <div class="container">
        <div class="media-grid">
          <Books books={currentBooks} />
          <Albums albums={currentAlbums} />
        </div>
      </div>
    </section>

    <!-- Writing -->
    <section id="writing">
      <div class="container">
        {recentPosts.length > 0 ? (
          <Writing posts={recentPosts} blogUrl="https://makingpublicwork.com" />
        ) : (
          <div class="writing-fallback">
            <h2 class="section-heading">Writing</h2>
            <p>Read my essays and newsletters at <a href="https://makingpublicwork.com" target="_blank" rel="noopener">Making Public Work</a> and <a href="https://blog.ronbronson.com" target="_blank" rel="noopener">my blog</a>.</p>
          </div>
        )}
      </div>
    </section>

    <!-- Contact -->
    <section id="contact">
      <div class="container">
        <Contact
          email="contact@ronbronson.com"
          socials={socials}
        />
      </div>
    </section>
  </main>

  <Footer
    techStack={techStack}
    fonts={fonts}
  />
</Base>

<style>
  /* Currently section - AIM style with distinct background */
  .currently-section {
    background: var(--surface-2);
    border-left: 4px solid var(--brand);
    margin-bottom: var(--size-5);
  }

  .currently-content {
    padding: var(--size-4);
  }

  .currently-content .label {
    margin-bottom: var(--size-2);
  }

  .currently-status {
    font-size: var(--font-size-1);
    color: var(--text-1);
    max-width: 70ch;
    line-height: 1.6;
    margin: 0;
  }

  /* Section headings */
  .section-heading {
    font-size: clamp(var(--font-size-2), 4vw, var(--font-size-3));
    margin-bottom: var(--size-4);
    font-family: var(--font-mono);
    font-weight: var(--font-weight-6);
  }

  /* Featured Media List */
  .media-list-featured {
    display: flex;
    flex-direction: column;
    gap: var(--size-5);
    margin-bottom: var(--size-5);
  }

  .section-intro {
    color: var(--text-3);
    margin-bottom: var(--size-4);
    font-size: var(--font-size-1);
  }

  @media (max-width: 600px) {
    .section-heading {
      margin-bottom: var(--size-3);
    }

    .section-intro {
      margin-bottom: var(--size-3);
    }
  }

  /* Work grid - 3 columns, denser */
  .work-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--size-4);
  }

  @media (max-width: 900px) {
    .work-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 600px) {
    .work-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Preview sections */
  #about-preview,
  #media-preview {
    margin-bottom: var(--size-5);
  }

  .about-preview-text,
  .media-preview-text {
    font-size: var(--font-size-1);
    color: var(--text-2);
    max-width: 70ch;
    line-height: 1.6;
    margin-bottom: var(--size-3);
  }

  .section-link {
    display: inline-flex;
    align-items: center;
    font-size: var(--font-size-1);
    color: var(--brand);
    font-weight: var(--font-weight-5);
    text-decoration: none;
  }

  .section-link:hover {
    text-decoration: underline;
  }

  /* Writing fallback */
  .writing-fallback {
    margin-block: var(--size-6);
  }

  .writing-fallback p {
    font-size: var(--font-size-1);
    color: var(--text-2);
    max-width: 70ch;
    line-height: 1.6;
  }

  .writing-fallback a {
    color: var(--brand);
    text-decoration: none;
  }

  .writing-fallback a:hover {
    text-decoration: underline;
  }

  /* Media section - Books & Albums side by side */
  #media-consumption {
    margin-bottom: var(--size-5);
  }

  .media-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--size-6);
  }

  @media (max-width: 768px) {
    .media-grid {
      grid-template-columns: 1fr;
      gap: var(--size-5);
    }
  }
</style>
