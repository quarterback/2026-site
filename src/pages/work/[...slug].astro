---
import { supabase } from '../../lib/supabase';
import Base from '../../layouts/Base.astro';

export async function getStaticPaths() {
  const { data: work } = await supabase
    .from('work_items')
    .select('*')
    .eq('published', true);

  return (work || []).map(item => ({
    params: { slug: item.slug },
    props: { item },
  }));
}

const { item } = Astro.props;
const {
  title,
  description,
  content,
  client,
  year,
  tags,
  hero_image
} = item;
---

<Base title={`${title} — Ron Bronson`}>
  <article class="case-study">
    <header class="case-study__header">
      <div class="container">
        <a href="/#work" class="back-link">&larr; Back to work</a>
        <div class="case-study__meta">
          {client && <span class="case-study__type">{client}</span>}
          {year && <span class="case-study__timeline">{year}</span>}
        </div>
        <h1>{title}</h1>
        <p class="case-study__summary">{description}</p>
        {tags && tags.length > 0 && (
          <div class="case-study__tags">
            {tags.map(tag => <span class="tag">{tag}</span>)}
          </div>
        )}
      </div>
    </header>

    {hero_image && (
      <div class="case-study__hero">
        <div class="container">
          <img src={hero_image} alt={title} />
        </div>
      </div>
    )}

    <div class="case-study__body">
      <div class="container container--narrow">
        <div set:html={content} />
      </div>
    </div>

    <footer class="case-study__footer container">
      <a href="/#work" class="back-link">&larr; Back to all work</a>
    </footer>
  </article>
</Base>

<style>
  .case-study__header {
    padding-block: var(--size-8) var(--size-7);
    border-bottom: 1px solid var(--surface-3);
  }

  .back-link {
    display: inline-block;
    font-size: var(--font-size-0);
    color: var(--text-3);
    margin-bottom: var(--size-4);
  }

  .back-link:hover {
    color: var(--brand);
  }

  .case-study__meta {
    display: flex;
    gap: var(--size-3);
    flex-wrap: wrap;
    margin-bottom: var(--size-3);
    font-family: var(--font-mono);
    font-size: var(--font-size-0);
  }

  .case-study__type {
    color: var(--brand);
  }

  .case-study__role,
  .case-study__timeline {
    color: var(--text-3);
  }

  .case-study__header h1 {
    margin-bottom: var(--size-4);
  }

  .case-study__summary {
    font-size: var(--font-size-2);
    color: var(--text-2);
    margin-bottom: var(--size-3);
    max-width: 65ch;
  }

  .case-study__context {
    font-size: var(--font-size-1);
    color: var(--text-3);
    max-width: 65ch;
  }

  .case-study__tags {
    display: flex;
    gap: var(--size-2);
    flex-wrap: wrap;
    margin-top: var(--size-3);
  }

  .tag {
    display: inline-block;
    padding: var(--size-1) var(--size-3);
    background: var(--surface-3);
    color: var(--text-2);
    border-radius: var(--radius-2);
    font-size: var(--font-size-0);
  }

  .case-study__hero {
    padding-block: var(--size-6);
    background: var(--surface-2);
    border-bottom: 1px solid var(--surface-3);
  }

  .case-study__hero img {
    width: 100%;
    height: auto;
    border-radius: var(--radius-2);
    border: 1px solid var(--surface-3);
  }

  .case-study__body {
    padding-block: var(--size-8);
  }

  .case-study__section {
    margin-top: var(--size-8);
  }

  .case-study__section:first-child {
    margin-top: 0;
  }

  .case-study__section h2 {
    font-size: var(--font-size-3);
    margin-bottom: var(--size-4);
    color: var(--text-1);
  }

  .case-study__list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .case-study__list li {
    padding-left: var(--size-5);
    margin-bottom: var(--size-3);
    position: relative;
    color: var(--text-2);
    line-height: var(--font-lineheight-3);
  }

  .case-study__list li::before {
    content: "→";
    position: absolute;
    left: 0;
    color: var(--brand);
    font-weight: var(--font-weight-6);
  }

  .artifacts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--size-4);
  }

  .case-study__body :global(h2) {
    font-size: var(--font-size-3);
    margin-top: var(--size-8);
    margin-bottom: var(--size-4);
    color: var(--text-1);
  }

  .case-study__body :global(h3) {
    font-size: var(--font-size-2);
    margin-top: var(--size-6);
    margin-bottom: var(--size-3);
    color: var(--text-1);
  }

  .case-study__body :global(p) {
    margin-bottom: var(--size-4);
    color: var(--text-2);
    line-height: var(--font-lineheight-3);
  }

  .case-study__body :global(ul),
  .case-study__body :global(ol) {
    margin-bottom: var(--size-4);
    padding-left: var(--size-5);
    color: var(--text-2);
  }

  .case-study__body :global(li) {
    margin-bottom: var(--size-2);
    line-height: var(--font-lineheight-3);
  }

  .case-study__body :global(img) {
    max-width: 100%;
    border-radius: var(--radius-2);
    margin-block: var(--size-6);
    border: 1px solid var(--surface-3);
    padding: var(--size-2);
    background: var(--surface-1);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .case-study__footer {
    padding-block: var(--size-5);
    border-top: 1px solid var(--surface-3);
  }
</style>
